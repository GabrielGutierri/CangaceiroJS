{"version":3,"sources":["../../app-src/controllers/NegociacaoController.js"],"names":["Negociacoes","NegociacaoService","Negociacao","NegociacaoView","MensagemView","Mensagem","DateConverter","getNegociacaoDao","Bind","getExceptionMessage","debounce","controller","bindEvent","NegociacaoController","constructor","_inputData","_inputQuantidade","_inputValor","Object","assign","_negociacoes","console","log","_mensagem","_service","_init","dao","negociacoes","listaTodos","forEach","adiciona","negociacao","err","texto","event","_criaNegociacao","_limpaFormulario","value","focus","paraData","parseInt","parseFloat","apaga","apagaTodos","esvazia","importaNegociacoes","obterNegociacoesDoPeriodo","filter","paraArray","some","novaNegociacao","equals","negociacaoExistente","ordena","coluna","_ordemAtual","inverteOrdem","a","b"],"mappings":"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","file":"NegociacaoController.js","sourcesContent":["import{Negociacoes, NegociacaoService, Negociacao} from '../domain/index.js';\r\nimport { NegociacaoView, MensagemView, Mensagem, DateConverter } from '../ui/index.js';\r\nimport { getNegociacaoDao, Bind, getExceptionMessage, debounce, controller, bindEvent } from '../util/index.js';\r\n\r\n@controller('#data','#quantidade','#valor')\r\n\r\nexport class NegociacaoController{\r\n    \r\n    constructor(_inputData, _inputQuantidade, _inputValor){\r\n        \r\n        Object.assign(this, {_inputData, _inputQuantidade, _inputValor});\r\n\r\n        this._negociacoes = new Bind(new Negociacoes(), new NegociacaoView('#negociacoes'), 'adiciona','esvazia','ordena','inverteOrdem');\r\n        console.log(this._negociacoes);\r\n        this._mensagem = new Bind(new Mensagem(), new MensagemView('#mensagemView'),'texto');\r\n        this._service = new NegociacaoService();\r\n\r\n        this._init();\r\n\r\n    }\r\n\r\n    async _init(){\r\n        try{\r\n            const dao = await getNegociacaoDao();\r\n            const negociacoes = await dao.listaTodos(); \r\n            negociacoes.forEach(negociacao => \r\n                this._negociacoes.adiciona(negociacao)\r\n                )\r\n        }\r\n        catch(err){\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    @bindEvent('submit', '.form')\r\n    @debounce()\r\n    async adiciona(event){\r\n        try{\r\n            // event.preventDefault();\r\n\r\n            const negociacao = this._criaNegociacao();\r\n\r\n            const dao = await getNegociacaoDao();\r\n            await dao.adiciona(negociacao);\r\n            this._negociacoes.adiciona(negociacao);\r\n            this._mensagem.texto = \"Negociação adicionada com sucesso!\";\r\n            this._limpaFormulario();\r\n                \r\n        }catch(err){\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n    \r\n    _limpaFormulario() {\r\n        this._inputData.value = '';\r\n        this._inputQuantidade.value = 1;\r\n        this._inputValor.value = 0.0;\r\n        this._inputData.focus();\r\n    }\r\n\r\n    _criaNegociacao(){\r\n        return new Negociacao(\r\n            DateConverter.paraData(this._inputData.value),\r\n                    parseInt(this._inputQuantidade.value),\r\n                    parseFloat(this._inputValor.value)\r\n\r\n        );\r\n    }\r\n\r\n    @bindEvent('click', '#botao-apaga')\r\n    async apaga(){\r\n\r\n        try{\r\n        const dao = await getNegociacaoDao();\r\n        await dao.apagaTodos();\r\n        this._negociacoes.esvazia();\r\n        this._mensagem.texto = \"Negociações apagadas com sucesso!\";\r\n        }\r\n        catch(err){ \r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n    }\r\n\r\n    @bindEvent('click','#botao-importa')\r\n    @debounce()\r\n    async importaNegociacoes(){\r\n        try{\r\n            \r\n            const negociacoes = await this._service.obterNegociacoesDoPeriodo();\r\n            \r\n            negociacoes.filter(novaNegociacao => \r\n                    !this._negociacoes.paraArray().some(negociacaoExistente =>\r\n                        novaNegociacao.equals(negociacaoExistente)))\r\n                .forEach(negociacao=> this._negociacoes.adiciona(negociacao));\r\n                this._mensagem.texto = \"Negociações importadas com sucesso\";\r\n            \r\n        }\r\n        catch(err){\r\n            this._mensagem.texto = getExceptionMessage(err);\r\n        }\r\n        \r\n    }\r\n\r\n    ordena(coluna){\r\n        if(this._ordemAtual == coluna){\r\n            this._negociacoes.inverteOrdem();\r\n        }\r\n        else{\r\n            this._negociacoes.ordena((a,b) => a[coluna] - b[coluna]);\r\n        }\r\n        this._ordemAtual = coluna;\r\n    }\r\n}"]}